---
title: Configuration
description: Configure money columns, currencies, and helper functions
---

# Configuration

## Static Currency

When all rows in a table use the same currency:

```typescript
const supabase = createCentSupabaseClient(url, key, {
  tables: {
    products: {
      money: {
        price: { currencyCode: 'USD' },
        cost: { currencyCode: 'USD' }
      }
    }
  }
})
```

## Dynamic Currency

When currency varies per row (stored in another column):

```typescript
const supabase = createCentSupabaseClient(url, key, {
  tables: {
    orders: {
      money: {
        total: { currencyColumn: 'currency' },
        tax: { currencyColumn: 'currency' }
      }
    }
  }
})

// On insert, currency column is auto-populated
await supabase.from('orders').insert({
  total: Money('€150.00'),
  tax: Money('€15.00')
  // currency automatically set to 'EUR'
})
```

## Minor Units

When storing cents, satoshis, or wei as integers:

```typescript
const supabase = createCentSupabaseClient(url, key, {
  tables: {
    transactions: {
      money: {
        amount_sats: { currencyCode: 'BTC', minorUnits: true }
      }
    }
  }
})

// Database: 150000000 (integer) -> Money("1.5 BTC")
```

## Realtime Subscriptions

Subscriptions automatically transform payloads:

```typescript
supabase
  .channel('orders')
  .on('postgres_changes', {
    event: 'INSERT',
    schema: 'public',
    table: 'orders'
  }, (payload) => {
    console.log(payload.new.total.toString()) // Money object
  })
  .subscribe()
```

## Helper Functions

For RPC results or manual transformations:

```typescript
import {
  parseMoneyResult,
  serializeMoney,
  moneySelect
} from '@thesis-co/cent-supabase'

// Transform RPC results
const { data } = await supabase.rpc('calculate_total', { order_id: '...' })
const result = parseMoneyResult(data, {
  total: { currencyCode: 'USD' }
})

// Serialize Money for custom mutations
const serialized = serializeMoney(
  { price: Money('$99.99') },
  { price: { currencyCode: 'USD' } }
)
// { price: '99.99' }

// Build select string with casts
moneySelect('id, name, price', ['price'])
// "id, name, price::text"
```

## Limitations

- **Nested relations**: Money columns in nested selects (e.g., `orders(items(price))`) aren't auto-transformed. Use `parseMoneyResult` on nested data.

- **Computed expressions**: Use explicit `::text` cast:
  ```typescript
  .select('(price * qty)::text as subtotal')
  ```

- **RPC functions**: Transform results with `parseMoneyResult`

## Wrapping an Existing Client

If you already have a Supabase client instance:

```typescript
import { wrapSupabaseClient } from '@thesis-co/cent-supabase'

const existingClient = createClient(url, key)
const supabase = wrapSupabaseClient(existingClient, {
  tables: {
    products: {
      money: { price: { currencyCode: 'USD' } }
    }
  }
})
```
